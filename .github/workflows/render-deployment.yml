name: Render Deployment Status

on:
  push:
    branches:
      - main

jobs:
  create-deployment:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      deployments: write
    steps:
      - name: Create GitHub Deployment
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            try {
              const deployment = await github.rest.repos.createDeployment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                ref: context.sha,
                environment: 'production',
                auto_merge: false,
                required_contexts: []
              });
              
              if (deployment.data.id) {
                await github.rest.repos.createDeploymentStatus({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  deployment_id: deployment.data.id,
                  state: 'success',
                  environment: 'production',
                  environment_url: 'https://pokerpal.onrender.com',
                  log_url: 'https://pokerpal.onrender.com',
                  description: 'Deployed to Render - https://pokerpal.onrender.com'
                });
                
                console.log('Deployment created successfully:', deployment.data.id);
                console.log('Deployment URL: https://pokerpal.onrender.com');
              }
            } catch (error) {
              console.error('Deployment error:', error);
              throw error;
            }
